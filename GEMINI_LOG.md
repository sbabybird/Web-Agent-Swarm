# Project Log: Web Agent Swarm

---

### **长期工作指令 (First Principle)**

**在开始任何开发任务前，必须先更新相关文档（如`docs/Preliminary_Plan.md`）和本工作日志（`GEMINI_LOG.md`），以确保项目状态和决策的可追溯性。**

---

### **架构决策与下一步计划 (2025-07-31)**

*   **核心洞察**: 当前“固定指令执行”（`case` 语句）的架构，极大地限制了 LLM 的能力，使其无法处理更复杂的、动态的网页任务，也未能充分利用 Playwright MCP 协议的潜力。

*   **架构升级决策**: 我们决定从“固定指令执行”模型，全面转向“**动态代码生成与安全执行**”模型。

*   **新架构蓝图**:
    1.  **Manager Agent 的新职责**: 不再生成 JSON 指令，而是直接生成一段**可执行的、自包含的 Playwright JavaScript 代码字符串**。
    2.  **后端重构**: 废弃 `/execute-action` 接口，创建一个新的 `/execute-code` 接口。
    3.  **安全沙箱执行**: 后端将使用 Node.js 的 `vm` 模块创建一个严格隔离的沙箱，用于安全地执行 LLM 生成的代码。沙箱将只暴露一个 `page` 对象和一个 `console` 对象，杜绝任何潜在的安全风险。
    4.  **前端更新**: 前端将调用新的 `/execute-code` 接口。

*   **下一步行动计划**: 立即着手实施上述四步架构重构计划。

### **架构决策：向多能力平台演进 (2025-07-31)**

*   **核心洞察**: 为了将项目从单一用途的工具提升为真正的智能平台，我们需要支持多种不同类型的任务和能力。

*   **架构升级决策**: 我们将扩展系统，在现有的“网页自动化”能力之外，新增一个并行的“**Canvas绘图**”能力。

*   **新架构蓝图**:
    1.  **前端UI**: 创建一个新的`DrawingCanvas.tsx`组件，并将其集成到主页面。
    2.  **新智能体 (Drawing Expert)**: 创建一个新的`drawing_prompt.txt`，引导LLM将自然语言的绘画描述，转换为结构化的JSON绘图指令。
    3.  **Manager Agent升级 (任务调度总管)**: 升级`manager_prompt.txt`，使其能够首先判断用户任务的类型（网页自动化 vs. 绘图），然后调用相应的专家智能体，并返回一个带有`taskType`标识的结构化JSON。
    4.  **新后端服务**: 在`backend/server.js`中添加一个新的`/draw`端点，用于验证和传递绘图指令。
    5.  **前端调度逻辑**: 重构`App.tsx`的`handleSubmit`函数，使其能够根据`taskType`，将任务分发给不同的执行逻辑（调用`/execute-code`或将绘图指令传递给Canvas组件）。

*   **下一步行动计划**: 立即着手实施上述五步架构演进计划。